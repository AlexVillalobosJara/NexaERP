@page "/"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@attribute [Authorize]

<PageTitle>Dashboard - NexaERP</PageTitle>

<AuthorizeView Context="homeContext">
    <Authorized>
        <h1>¡Bienvenido a NexaERP!</h1>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="oi oi-person"></i> Información del Usuario</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Nombre:</strong> @homeContext.User.FindFirst("full_name")?.Value</p>
                        <p><strong>Email:</strong> @homeContext.User.FindFirst("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress")?.Value</p>
                        <p><strong>Empresa:</strong> @homeContext.User.FindFirst("empresa_nombre")?.Value</p>
                        <p><strong>Roles:</strong> @string.Join(", ", homeContext.User.FindAll("http://schemas.microsoft.com/ws/2008/06/identity/claims/role").Select(c => c.Value))</p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5><i class="oi oi-check"></i> ¡Sistema Funcionando!</h5>
                    </div>
                    <div class="card-body">
                        <p>✅ Base de datos configurada</p>
                        <p>✅ Autenticación JWT activa</p>
                        <p>✅ Sistema multi-tenant operativo</p>
                        <p>✅ Seguridad empresarial habilitada</p>

                        <AuthorizeView Roles="Administrador" Context="adminContext">
                            <Authorized>
                                <div class="mt-3">
                                    <a href="/usuarios" class="btn btn-primary me-2">
                                        <i class="oi oi-people"></i> Gestionar Usuarios
                                    </a>
                                </div>
                            </Authorized>
                        </AuthorizeView>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="alert alert-info">
                <h4><i class="oi oi-info"></i> ¡Felicitaciones!</h4>
                <p>Has implementado exitosamente un sistema ERP empresarial completo con:</p>
                <ul>
                    <li>🔐 <strong>Autenticación segura</strong> con JWT y hash de contraseñas</li>
                    <li>🏢 <strong>Multi-tenancy</strong> - separación completa de datos por empresa</li>
                    <li>👥 <strong>Sistema de roles y permisos</strong> granular</li>
                    <li>📊 <strong>Auditoría completa</strong> de eventos de seguridad</li>
                    <li>🇨🇱 <strong>Configuración chilena</strong> - RUT, fechas, moneda</li>
                    <li>⚡ <strong>Arquitectura Clean</strong> escalable y mantenible</li>
                </ul>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="alert alert-warning">
            <p>Debe iniciar sesión para acceder al sistema.</p>
            <a href="/login" class="btn btn-primary">Iniciar Sesión</a>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    // Código adicional si es necesario
}